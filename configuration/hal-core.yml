parameters:
    # default parameters
    doctrine.devmode: false
    doctrine.proxy.dir: '.doctrine'
    doctrine.connection:
        driver: 'pdo_mysql'
        host: 'localhost'
        user: 'root'
        password: ''
        dbname: 'hal'

    doctrine.lvl2cache.enabled: true
    doctrine.lvl2cache.ttl: 600
    doctrine.lvl2cache.lock: 60

services:

    ####################################################################################################################
    # DOCTRINE PATHS
    ####################################################################################################################

    doctrine.proxy.generator:
        class: 'QL\Hal\Core\Utility\DoctrineProxyGenerator'
        arguments: ['@service_container']

    ####################################################################################################################
    # DOCTRINE PATHS
    ####################################################################################################################

    doctrine.mapping.dir.hal:
        class: 'stdClass'
        factory: ['QL\Hal\Core\Utility\DoctrineFactory', 'halYaml']

    doctrine.mapping.dir.kraken:
        class: 'stdClass'
        factory: ['QL\Hal\Core\Utility\DoctrineFactory', 'krakenYaml']

    doctrine.proxy.dir:
        class: 'stdClass'
        factory: ['QL\Hal\Core\Utility\DoctrineFactory', 'proxyPath']
        arguments: ['%doctrine.proxy.dir%']

    ####################################################################################################################
    # DOCTRINE EM
    ####################################################################################################################

    doctrine.em:
        class: 'Doctrine\ORM\EntityManager'
        factory: ['Doctrine\ORM\EntityManager', 'create']
        arguments:
            - '%doctrine.connection%'
            - '@doctrine.config'
            - '@doctrine.em.events'
        configurator: ['@doctrine.em.configurator', 'configure']

    doctrine.em.configurator:
        class: 'QL\Hal\Core\Utility\DoctrineConfigurator'
        calls:
            - ['addEntityMappings', ['@doctrine.types.hal']]
            - ['addEntityMappings', ['@doctrine.types.kraken']]

    doctrine.em.events:
        class: 'Doctrine\Common\EventManager'

    ####################################################################################################################
    # DOCTRINE CONFIG
    ####################################################################################################################

    doctrine.config:
        class: 'Doctrine\ORM\Configuration'
        factory: ['Doctrine\ORM\Tools\Setup', 'createConfiguration']
        arguments:
            - '%doctrine.devmode%'
            - '@doctrine.proxy.dir'
            - '@doctrine.cache'
        calls:
            - ['setMetadataDriverImpl', ['@doctrine.config.driver']]
            - ['setSecondLevelCacheEnabled', ['%doctrine.lvl2cache.enabled%']]
            - ['setSecondLevelCacheConfiguration', ['@doctrine.secondlevelcache.config']]

    doctrine.config.driver:
        class: 'Doctrine\ORM\Mapping\Driver\SimplifiedYamlDriver'
        arguments: ['@doctrine.mapping.dirs']
        calls:
            - ['setGlobalBasename', ['global']]

    doctrine.mapping.dirs:
        class: 'stdClass'
        factory: ['QL\Hal\Core\Utility\DoctrineFactory', 'buildConfigurationMapping']
        arguments:
            - ['@doctrine.mapping.dir.hal', 'QL\Hal\Core\Entity']
            - ['@doctrine.mapping.dir.kraken', 'QL\Kraken\Core\Entity']

    ####################################################################################################################
    # TYPES
    ####################################################################################################################

    doctrine.types.hal:
        class: 'stdClass'
        factory: ['QL\Hal\Core\Utility\DoctrineCustomTypes', 'getMapping']

    doctrine.types.kraken:
        class: 'stdClass'
        factory: ['QL\Kraken\Core\Utility\DoctrineCustomTypes', 'getMapping']

    ####################################################################################################################
    # DOCTRINE CACHE
    ####################################################################################################################

    # default to array
    doctrine.cache:
        class: 'Doctrine\Common\Cache\ArrayCache'

    doctrine.secondlevelcache.config:
        class: 'Doctrine\ORM\Cache\CacheConfiguration'
        calls:
            - ['setCacheFactory', ['@doctrine.secondlevelcache.factory']]

    doctrine.secondlevelcache.factory:
        class: 'Doctrine\ORM\Cache\DefaultCacheFactory'
        arguments: ['@doctrine.secondlevelcache.region.config', '@doctrine.cache']

    doctrine.secondlevelcache.region.config:
        class: 'Doctrine\ORM\Cache\RegionsConfiguration'
        arguments: ['%doctrine.lvl2cache.ttl%', '%doctrine.lvl2cache.lock%']

    ####################################################################################################################
    # DOCTRINE HELPERS
    ####################################################################################################################

    doctrine.random:
        class: 'QL\Hal\Core\RandomGenerator'
